<?php
// File path to store visitor count
$countFilePath = 'visitor_count.txt';

// Read the current visitor count from the file
$visitorCount = (int)file_get_contents($countFilePath);

// Increment the visitor count
$visitorCount++;

// Save the updated visitor count back to the file
file_put_contents($countFilePath, $visitorCount);

// Output the visitor count
echo "<p>Total files checked: $visitorCount</p>";

// Check if a hash value is submitted
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['hash'])) {
    $hashesDir = 'Hashes/';
    $totalHashFiles = 500;

    // Get the submitted hash value
    $hash = $_POST['hash'];

    // Initialize variable to track if the hash is found
    $isInfected = false;

    // Loop through hash files to check for a match
    for ($i = 0; $i <= $totalHashFiles; $i++) {
        $filePath = $hashesDir . $i;

        if (file_exists($filePath)) {
            $file = fopen($filePath, 'r');
            if ($file) {
                while (($line = fgets($file)) !== false) {
                    if (trim($line) === $hash) {
                        $isInfected = true;
                        break 2; // Exit both loops
                    }
                }
                fclose($file);
            }
        }
    }

    // Output result
    echo '<p>Hash value submitted: ' . $hash . '</p>';

    // Determine if the hash is found or not
    if ($isInfected) {
        echo '<h2 style="color: red;">HASH MATCH FOUND: FILE IS INFECTED</h2>';
    } else {
        echo '<h2 style="color: green;">HASH MATCH NOT FOUND: FILE IS SAFE</h2>';
    }
} else {
    echo '<p>No hash value submitted.</p>';
}
?>
