<?php

// File path to store visitor count
$countFilePath = 'visitor_count.txt';

// Read the current visitor count from the file
$visitorCount = (int)file_get_contents($countFilePath);

// Increment the visitor count
$visitorCount++;

// Save the updated visitor count back to the file
file_put_contents($countFilePath, $visitorCount);

// Output the visitor count
echo "<p>Total files checked: $visitorCount</p>";


if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['fileHash'])) {
    $hashesDir = 'Hashes/';
    $totalHashFiles = 500; // Adjust this number based on the actual number of hash files

    $hash = $_POST['fileHash'];
    $isInfected = false;

    // Loop through hash files to check for a match
    for ($i = 0; $i < $totalHashFiles; $i++) {
        $filePath = $hashesDir . $i;

        // Check if the file exists
        if (file_exists($filePath)) {
            // Open the file
            $file = fopen($filePath, 'r');
            
            // Check if the file is successfully opened
            if ($file) {
                // Read each line from the file
                while (($line = fgets($file)) !== false) {
                    // Check if the hash exists in the current line
                    if (trim($line) === $hash) {
                        $isInfected = true;
                        break 2; // Exit both loops if the hash is found
                    }
                }
                // Close the file
                fclose($file);
            }
        }
    }

    // Output result
    if ($isInfected) {
        echo '<h2 style="color: red;">FILE IS INFECTED</h2>';
    } else {
        echo '<h2 style="color: green;">FILE IS SAFE</h2>';
    }
} else {
    echo '<p>No file uploaded.</p>';
}
?>
